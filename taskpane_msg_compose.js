!function(){var e={77325:function(e,t,n){"use strict";e.exports=n.p+"assets/spin.gif"},90435:function(e,t,n){"use strict";e.exports=n.p+"c8a82345f3d800731acf.js"},58394:function(e,t,n){"use strict";e.exports=n.p+"1fda685b81e1123773f6.css"}},t={};function n(o){var s=t[o];if(void 0!==s)return s.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,n),a.exports}n.m=e,n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n.b=document.baseURI||self.location.href,function(){let e={to:"",sender:"",subject:"",date:"",cc:"",body:"",attachments:[]},t="",n="",o=[];Office.onReady((e=>{if(e.host===Office.HostType.Outlook){t="",document.querySelector("#cflex-init").style.display="none",console.log("Flex365x Outlook Addin: compose"),document.querySelector("#cflex-app-body").style.display="flex";const e=setInterval((()=>{if(document.querySelector("#cflex-app-body").checkVisibility()){const e=Office.context.mailbox.item;o=[];let s="";e.to.getAsync((e=>{for(let t=0;t<e.value.length;t++){const a=e.value[t];""===n&&(n=a.emailAddress),o.push({displayName:a.displayName,emailAddress:a.emailAddress}),s+=a.emailAddress}c(s!=t,o,n),t=s}))}else clearInterval(e)}),1e3)}}));const s=e=>{let t=e.displayName;return-1===e.displayName.indexOf("@")&&(t+=" ("+e.emailAddress+")"),t},a=e=>{let t="";const n=(e,t)=>{let n="";const o=[];let s=0,a="";do{a=e.substr(s,t),""!==a&&o.push(a),s+=t}while(""!==a);return o.length>-1&&(n=o.join("\r\n")),n};t+=`To: ${e.to}\r\nFrom: ${e.sender}\r\nCC: ${e.cc}\r\nSubject: ${e.subject}\r\nDate: ${(new Date).toUTCString()}\r\n`,t+="Content-Type: multipart/mixed; boundary=--boundary_text_string\r\n",t+="\r\n----boundary_text_string\r\nContent-Type: text/html; charset=ISO-8859-1\r\n",t+="Content-Transfer-Encoding: quoted-printable\r\n\r\n",t+="<html><head></head><body>",void 0!==e.body&&(t+=e.body),t+="</body></html>";for(const o of e.attachments)t+="\r\n\r\n----boundary_text_string\r\n",t+=`Content-Type: ${o.contentType}; name="${o.name}"\r\n`,t+=`Content-Disposition: attachment; filename="${o.name}"; size=${o.size.toString()}\r\n`,t+="Content-Transfer-Encoding: base64\r\n\r\n",t+=`${n(o.base64Content,76)}`;return t+="\r\n\r\n----boundary_text_string--",console.log(t),t},i=e=>{window.open(`https://44g7q3.sharepoint.com/sites/Flex/SitePages/CollabHome.aspx?sw=bypass&search=${e}`)},c=(t,n,o)=>new Promise((a=>{const c=Office.context.mailbox.item,d=document.querySelector("#cflex-app-body"),m=document.querySelector("#cflex-select-item-prompt"),p=document.querySelector("#cflex-wait"),f=document.querySelector("#cflex-search-to-container"),u=document.querySelector("#cflex-search-link-sender-name"),y=document.querySelector("#cflex-search-link-sender-address");f&&u&&y&&d&&m&&p?t&&(d.style.display="none",m.style.display="none",p.style.display="flex",f.replaceChildren(),u.replaceChildren(),y.replaceChildren()):a(),c||(p.style.display="none",m.style.display="flex",a()),e={to:"",sender:"",subject:"",date:"",cc:"",body:"",attachments:[]},e.sender=`${Office.context.mailbox.userProfile.displayName} (${Office.context.mailbox.userProfile.emailAddress})`;const h=[];n.forEach((t=>{""===o&&(o=t.emailAddress),e.to.length>0&&(e.to+="; "),e.to+=s(t),h.push({displayName:t.displayName,emailAddress:t.emailAddress})})),c.cc.getAsync((t=>{t.value.forEach((t=>{e.cc.length>0&&(e.cc+="; "),theMailItem.cc+=s(t)})),c.body.getAsync(Office.CoercionType.Html,null,(t=>{e.body=t.value,c.subject.getAsync((t=>{e.subject=t.value;const n=[];c.getAttachmentsAsync((e=>{for(const t of e.value)n.push(l(c,t.id));Promise.all(n).then((()=>{const e=document.querySelector("#cflex-drag-envelope");e&&e.addEventListener("dragstart",r);const t=document.createElement("a");t.href="javascript:void(0)",t.innerText=Office.context.mailbox.userProfile.displayName,t.style.paddingRight="20px",t.addEventListener("click",(()=>i(`${Office.context.mailbox.userProfile.displayName}`))),u.replaceChildren(),u.append(t);const n=document.createElement("a");n.href="javascript:void(0)",n.innerText=Office.context.mailbox.userProfile.emailAddress,n.addEventListener("click",(()=>i(`${Office.context.mailbox.userProfile.emailAddress}`))),y.replaceChildren(),y.append(n);const o=document.querySelector("#cflex-search-to-container");o&&(o.replaceChildren(),h.forEach((e=>{if(e.emailAddress!==Office.context.mailbox.emailAddress){const t=document.createElement("div"),n=document.createElement("a");if(n.href="javascript:void(0)",n.innerHTML=`${e.displayName}`,n.addEventListener("click",(()=>i(`${n.innerHTML}`))),t.appendChild(n),o.children.length>0&&(t.style.paddingTop="10px"),o.appendChild(t),e.displayName!==e.emailAddress){const t=document.createElement("div"),n=document.createElement("a");n.href="javascript:void(0)",n.innerHTML=`${e.emailAddress}`,n.addEventListener("click",(()=>i(`${n.innerHTML}`))),t.appendChild(n),o.appendChild(t)}}})))})),p.style.display="none",m.style.display="none",d.style.visibility="hidden",d.style.display="flex";const t=f;t.style.resize="",t.style.overflow="",t.style.height="auto",t.getBoundingClientRect().height>120&&(t.style.resize="vertical",t.style.overflow="auto",t.style.height="120px"),d.style.visibility=""}))}))}))}))})),l=(t,n)=>new Promise((o=>{t.getAttachmentContentAsync(n,(t=>{e.attachments.push({id:n,name:t.value.name,contentType:t.value.contentType,size:t.valuet.size,base64Content:t.value.content}),o()}))})),r=t=>{console.log(JSON.stringify({to:e.to,sender:e.sender,subject:e.subject,date:(new Date).toUTCString(),cc:e.cc,body:e.body,numAttachments:e.attachments.length.toString(),filename:`${e.subject.replace(/[^a-z0-9+]+/gi,"_")}_${(new Date).getMilliseconds().toString()}${Math.floor(1e3*Math.random())}.eml`,eml:a(e)})),t.dataTransfer.setData("text",JSON.stringify({to:e.to,sender:e.sender,subject:e.subject,date:(new Date).toUTCString(),cc:e.cc,body:e.body,numAttachments:e.attachments.length.toString(),filename:`${e.subject.replace(/[^a-z0-9+]+/gi,"_")}_${(new Date).getMilliseconds().toString()}${Math.floor(1e3*Math.random())}.eml`,eml:a(e)}))};Office.actions.associate("onMessageComposeHandler",(function(e){console.log("onMessageComposeHandler(): entered!");var t={asyncContext:{callingEvent:e}};Office.context.mailbox.item.notificationMessages.addAsync("showInfoBarForSampleInstructions",{type:Office.MailboxEnums.ItemNotificationMessageType.InsightMessage,message:"Open the Task Pane to save to Flex",icon:"Icon.16x16",actions:[{actionText:"Show Flex365x Task Pane",actionType:Office.MailboxEnums.ActionType.ShowTaskPane,commandId:"msgComposeOpenPaneButton",contextData:"{''}"}]},t,(function(e){console.log("onMessageComposeHandler(): Notification message added"),e.asyncContext.callingEvent.completed()}))}))}(),function(){"use strict";new URL(n(90435),n.b),new URL(n(58394),n.b),new URL(n(77325),n.b)}()}();
//# sourceMappingURL=taskpane_msg_compose.js.map